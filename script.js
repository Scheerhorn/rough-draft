const dailyDeals = {
  0: [ // Sunday
        // CENTRAL
          // RIDGELAND 
            {name: "Open Mind", deal: "&#127968 15% off store-wide", lat: 32.38819, lon:-90.11402},
            // Rootdown - Old Canton is closed on Sunday
            // Ignite need to check on Sunday 2/17
            // Southern Sky - Lakeland is closed on Sunday
            // Rootdown - Lakeland is closed on Sunday
          // PEARL
            {name: "Southern Sky - Pearl", deal: "&#10071 2 X loyalty points", lat: 32.26664, lon: -90.13920},
            // Voodoo Buds need to check if they have weekend deals 2/18
          // RICHLAND
            {name: "Oddfellow Wellness", deal: "&#127968 40-50% off select items", lat: 32.22353, lon: -90.15655},
          // FLOWOOD
            {name: "Spillway Dispensary", deal: "&#127968 15% off Store", lat: 32.38430, lon: -90.04180},
  ],
  1: [ // Monday
        // CENTRAL 
          // RIDGELAND
            {name: "Open Mind", deal: "&#127851 20% off Edibles", lat: 32.38819, lon:-90.11402},
            {name: "Rootdown - Old Canton", deal: "&#127804 20% off select micros Flower", lat: 32.36077, lon: -90.14643},
            {name: "Ignite", deal: "&#127851 20% off Edibles", lat: 32.3766, lon: -90.1472},
            {name: "Southern Sky - Lakeland", deal: "&#127851 20% off Edibles", lat: 32.3329, lon: -90.1386},
            {name: "Rootdown - Lakeland", deal: "&#127804 20% off select micros Flower", lat: 32.33369, lon: -90.1446},
          // PEARL
            {name: "Southern Sky - Pearl", deal: "&#127851 20% off edibles", lat: 32.26664, lon: -90.13920},
            {name: "Voodoo Buds", deal: "&#127968 10% off Store 4-9pm", lat: 32.28377, lon: -90.11204},
          // RICHLAND
            {name: "Oddfellow Wellness", deal: "&#127851 10% off edibles ", lat: 32.22353, lon: -90.15655},
          // FLOWOOD
            {name: "Spillway Dispensary", deal: "&#127851 20% off Edibles", lat: 32.38430, lon: -90.04180},
  ],
  2: [ // Tuesday
        // CENTRAL
          // RIDGELAND
            {name: "Open Mind", deal: "&#128684 20% off Pre-rolls", lat: 32.38819, lon:-90.11402},
            {name: "Rootdown - Old Canton", deal: "&#127851 Buy 2 get 1 100mg Gummies", lat: 32.36077, lon: -90.14643},
            {name: "Ignite", deal: "&#128167 20% off all Tincture", lat: 32.3766, lon: -90.1472},
            {name: "Southern Sky - Lakeland", deal: "&#9889 20% off Vapes", lat: 32.3329, lon: -90.1386},
            {name: "Rootdown - Lakeland", deal: "&#127851 Buy 2 get 1 100mg Gummies", lat: 32.33369, lon: -90.1446},
          // PEARL
            {name: "Southern Sky - Pearl", deal: "&#9889 20% off Vape Carts", lat: 32.26664, lon: -90.13920},
            {name: "Voodoo Buds", deal: "&#9889 15% off Carts", lat: 32.28377, lon: -90.11204},
          // RICHLAND
            {name: "Oddfellow Wellness", deal: "Update deal", lat: 32.22353, lon: -90.15655},
          // FLOWOOD
            {name: "Spillway Dispensary", deal: "&#128684 20% off Pre-rolls", lat: 32.38430, lon: -90.04180},
  ],
  3: [ // Wednesday
        // CENTRAL
          // RIDGELAND
            {name: "Open Mind", deal: "&#9889 &#127855 20% off Vapes & Concentrates", lat: 32.38819, lon:-90.11402},
            {name: "Rootdown - Old Canton", deal: "&#127855 BOGO 30% off Concentrates", lat: 32.36077, lon: -90.14643},
            {name: "Ignite", deal: "&#127968 20% off budtender's choice", lat: 32.3766, lon: -90.1472},
            {name: "Southern Sky - Lakeland", deal: "&#129524 &#128167 20% off Topicals & Tinctures", lat: 32.3329, lon: -90.1386},
            {name: "Rootdown - Lakeland", deal: "&#127855 BOGO 30% off Concentrates", lat: 32.33369, lon: -90.1446},
          // PEARL
            {name: "Southern Sky - Pearl", deal: "&#129524 &#128167 20% off Topicals & Tinctures", lat: 32.26664, lon: -90.13920},
            {name: "Voodoo Buds", deal: "&#128684 20% off Pre-Rolls", lat: 32.28377, lon: -90.11204},
          // RICHLAND
            {name: "Oddfellow Wellness", deal: "&#127855 10% off Concentrates", lat: 32.22353, lon: -90.15655},
          // FLOWOOD
            {name: "Spillway Dispensary", deal: "&#9889 &#127855 20% off Vapes & Concentrates", lat: 32.38430, lon: -90.04180},
  ],
  4: [ // Thursday
        // CENTRAL
          // RIDGELAND
            {name: "Open Mind", deal: "&#129524 20% off Topicals", lat: 32.38819, lon:-90.11402},
            {name: "Rootdown - Old Canton", deal: "&#127865 Buy 3 get 1 Noble Seltzer", lat: 32.36077, lon: -90.14643},
            {name: "Ignite", deal: "&#127865 BOGO 1/2 off Seltzer", lat: 32.3766, lon: -90.1472},
            {name: "Southern Sky - Lakeland", deal: "&#128684 20% off Pre-rolls", lat: 32.3329, lon: -90.1386},
            {name: "Rootdown - Lakeland", deal: "&#127865 Buy 3 get 1 Noble Seltzer", lat: 32.33369, lon: -90.1446},
          // PEARL
            {name: "Southern Sky - Pearl", deal: "&#128684 20% off Pre-rolls", lat: 32.26664, lon: -90.13920},
            {name: "Voodoo Buds", deal: "&#127968 10% off Store 4-9pm", lat: 32.28377, lon: -90.11204},
          // RICHLAND
            {name: "Oddfellow Wellness", deal: "&#127968 Budtender's choice", lat: 32.22353, lon: -90.15655},
          // FLOWOOD
            {name: "Spillway Dispensary", deal: "&#129524 20% off Topicals", lat: 32.38430, lon: -90.04180},
  ],
  5: [ // Friday
        // CENTRAL
          // RIDGELAND
            {name: "Open Mind", deal: "&#127804 $10 off each Flower item", lat: 32.38819, lon:-90.11402},
            {name: "Rootdown - Old Canton", deal: "&#127968 House Deal", lat: 32.36077, lon: -90.14643},
            {name: "Ignite", deal: "&#127804 20% off all Flower", lat: 32.3766, lon: -90.1472},
            {name: "Southern Sky - Lakeland", deal: "&#127804 20% off Flower", lat: 32.3329, lon: -90.1386},
            {name: "Rootdown - Lakeland", deal: "&#127968 House Deal", lat: 32.33369, lon: -90.1446},
          // PEARL
            {name: "Southern Sky - Pearl", deal: "&#127804 20% off Flower", lat: 32.26664, lon: -90.13920},
            {name: "Voodoo Buds", deal: "&#127851 10% off all Edibles", lat: 32.28377, lon: -90.11204},
          //RICHLAND
            {name: "Oddfellow Wellness", deal: "&#127968 20% off store-wide", lat: 32.22353, lon: -90.15655},
          // FLOWOOD
            {name: "Spillway Dispensary", deal: "&#127804 $10 off each Flower item", lat: 32.38430, lon: -90.04180},
  ],
  6: [ // Saturday
        // CENTRAL
          // RIDGELAND
            {name: "Open Mind", deal: "&#128092 20% off Accessories", lat: 32.38819, lon:-90.11402},
            {name: "Rootdown - Old Canton", deal: "&#9889 BOGO 30% off full-spectrum Carts", lat: 32.36077, lon: -90.14643},
            // Ignite need to check on Saturday
            {name: "Southern Sky - Lakeland", deal: "&#127855 20% off Concentrates", lat: 32.3329, lon: -90.1386},
            {name: "Rootdown - Lakeland", deal: "&#9889 BOGO 30% off full-spectrum Carts", lat: 32.33369, lon: -90.14466},
          // PEARL
            {name: "Southern Sky - Pearl", deal: "&#127855 20% off Concentrates", lat: 32.26664, lon: -90.13920},
            {name: "Voodoo Buds", deal: "", lat: 32.28377, lon: -90.11204},
            // Voodoo Buds need to check on weekend deals 
          // RICHLAND
            {name: "Oddfellow Wellness", deal: "&#127968 40-50% off select items", lat: 32.22353, lon: -90.15655},
          // FLOWOOD
            {name: "Spillway Dispensary", deal: "&#128092 20% off Accessories", lat: 32.38430, lon: -90.04180},
  ]  
  
  
  // template {name: "", deal: "", lat: 0, lon: 0},
  // house: &#127968 flower: &#127804 concentrate: &#127855 chocolate bar: &#127851 topical: &#129524 tincture: &#128167 
  // pre-roll: &#128684 vape: &#9889 accessories: &#128092 beverages: &#127865 rewards points: &#10071
};

const dayNames = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
const today = new Date().getDay(); 

const todayDeals = dailyDeals[today];

function displayCurrentDate() {
  const dateElement = document.getElementById("currentDate");
  
  // Get the current date
  const now = new Date();
  
  // Array of days to get the correct day name
  const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
  
  // Format the date
  const dayName = days[now.getDay()];
  const formattedDate = now.toLocaleDateString("en-US", {
      year: "numeric",
      month: "long",
      day: "numeric"
  });

  // Display the result
  dateElement.textContent = `${dayName}, ${formattedDate}`;
}

// Run the function when the page loads
window.onload = displayCurrentDate;

document.getElementById('currentDay').textContent = `Deals for ${dayNames[today]}`;

if (navigator.geolocation) {
  navigator.geolocation.getCurrentPosition(locateSuccess, locateError);
} else {
  console.error("Geolocation is not supported by your browser.");
}

function locateSuccess(position) {
  const userLat = position.coords.latitude;
  const userLng = position.coords.longitude;
  todayDeals.sort((a, b) => {
    const distanceA = haversineDistance(userLat, userLng, a.lat, a.lon);
    const distanceB = haversineDistance(userLat, userLng, b.lat, b.lon);
    return distanceA - distanceB; // Sort ascending (closest first)
  });
  
  let html = '<ul>';
  
  todayDeals.forEach(function(deal) {
    // Optionally calculate the distance to display with each deal
    const distance = haversineDistance(userLat, userLng, deal.lat, deal.lon);
    html += `<li>${deal.deal}, ${deal.name} - ${distance.toFixed(1)} mi</li>`;
  });
  html += '</ul>';
  // Inject the HTML into the element on your page
  document.getElementById('dealsList').innerHTML = html;
  
}
function locateError(error) {
console.log("Error");
}
function haversineDistance(lat1, lon1, lat2, lon2) {
  const R = 3958.8; // Radius of the Earth in kilometers. Use 3958.8 for miles.
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLon = (lon2 - lon1) * Math.PI / 180;
  const a =
    Math.sin(dLat / 2) ** 2 +
    Math.cos(lat1 * Math.PI / 180) *
    Math.cos(lat2 * Math.PI / 180) *
    Math.sin(dLon / 2) ** 2;
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  return R * c;
}
